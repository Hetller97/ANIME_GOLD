<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¹Ø§Ù…Ø© */
body {
  font-family: 'Tahoma', sans-serif;
  direction: rtl;
  background-color: #f4f6f9;
  margin: 0;
  padding: 20px;
  color: #333;
}

/* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ù…Ù‚Ø§Ø·Ø¹ */
.section {
  background: white;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 30px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

h2, h3 {
  margin-top: 0;
  color: #222;
}

/* Ø§Ù„Ø­Ù‚ÙˆÙ„ */
input, select, button {
  display: block;
  width: 100%;
  max-width: 400px;
  padding: 10px;
  margin: 10px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 16px;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
button {
  background-color: #007bff;
  color: white;
  border: none;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.3s;
}

button:hover {
  background-color: #0056b3;
}

.copy-btn {
  background-color: #28a745;
}

.copy-btn:hover {
  background-color: #1f7c36;
}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

th, td {
  border: 1px solid #ddd;
  padding: 10px;
  font-size: 15px;
}

th {
  background-color: #f1f1f1;
}

td button {
  padding: 5px 10px;
  font-size: 14px;
}

/* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
.results {
  background: #eafbea;
  padding: 15px;
  border-radius: 10px;
  margin-top: 15px;
  white-space: pre-wrap;
  font-family: 'Courier New', monospace;
}

/* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
.hidden {
  display: none;
}

/* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù‡ÙˆØ§ØªÙ */
@media (max-width: 600px) {
  table, thead, tbody, th, td, tr {
    display: block;
  }

  thead tr {
    display: none;
  }

  td {
    padding: 10px;
    position: relative;
    text-align: right;
    border: none;
    border-bottom: 1px solid #eee;
  }

  td:before {
    content: attr(data-label);
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
  }
}


/* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
#editModal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 999;
  background: white;
  width: 70%;
  max-width: 400px;
  box-shadow: 0 0 20px rgba(0,0,0,0.3);
}

/* Ø®Ù„ÙÙŠØ© Ø¶Ø¨Ø§Ø¨ÙŠØ© */
#overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(4px);
  z-index: 998;
  display: none;
}
  </style>
</head>
<body style="padding-top: 100PX;">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header>
            <div class="logo">
                <a href="index.html" ><img src="https://res.cloudinary.com/doe1glpxm/image/upload/v1737294905/icon_hqujqg.png" alt="Logo"></a>
            </div>
            <nav class="nav">
                <a href="anime_gold.html">Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="info.html">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</a>
                <a href="contactus.html">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
                
            </nav>
        </header>

  <div class="section">
    <h2>Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‡Ø§Ù† Ø¬Ø¯ÙŠØ¯</h2>
    <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:</label>
    <input type="number" id="competitionNumber" placeholder="Ù…Ø«Ø§Ù„: 1" /><br>
    <label>ÙƒÙˆØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨:</label>
    <input type="text" id="playerCode" placeholder="Ù…Ø«Ù„ A000A Ø£Ùˆ B000B" /><br>
    <label>Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ù‡Ø§Ù†:</label>
    <input type="number" id="betAmount" placeholder="Ù…Ø«Ø§Ù„: 100" /><br>
    <label>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø±Ø§Ù‡Ù† Ø¹Ù„ÙŠÙ‡:</label>
    <input type="text" id="chosenTeam" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚" /><br>
    <button class="btn" onclick="addBet()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù‡Ø§Ù†</button>
  </div>

  <div class="section">
    <h2>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª</h2>
    <button class="btn" onclick="showEndSection()">ğŸ”š Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª</button>
    <table id="betsTable">
      <thead>
        <tr>
          <th>Ø±Ù‚Ù… Ø§Ù„Ø±Ù‡Ø§Ù†</th>
          <th>ÙƒÙˆØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨</th>
          <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th>Ø§Ù„ÙØ±ÙŠÙ‚</th>
          <th>ØªØ¹Ø¯ÙŠÙ„</th>
          <th>Ø­Ø°Ù</th>
        </tr>
      </thead>
      <tbody id="betsBody"></tbody>
    </table>
  </div>

  <div id="endSection" class="section hidden">
    <h2>ğŸ’¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
    <label>Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ§Ø¦Ø²:</label>
    <input type="text" id="winningTeam" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ§Ø¦Ø²" />
    <button class="btn" onclick="calculateResults()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
    <div class="results hidden" id="resultsBox">
      <h3>Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</h3>
      <pre id="resultsText"></pre>
      <button class="btn copy-btn" onclick="copyResults()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
    </div>
  </div>


  <div id="editModal" class="section hidden">
    <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ù‡Ø§Ù†</h3>
    <input type="text" id="editCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨" />
    <input type="number" id="editAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ù‡Ø§Ù†" />
    <input type="text" id="editTeam" placeholder="Ø§Ù„ÙØ±ÙŠÙ‚" />
    <button class="btn" onclick="saveEdit()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
    <button class="btn" onclick="closeEditModal()">âŒ Ø¥Ù„ØºØ§Ø¡</button>
  </div>
  <div id="overlay" onclick="closeEditModal()"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>

const firebaseConfig = {
  apiKey: "AIzaSyBqUtqQQQSMw_3HkhlV4jaibHCz-UgQdh8",
  authDomain: "storegold-649cb.firebaseapp.com",
  databaseURL: "https://storegold-649cb-default-rtdb.firebaseio.com",
  projectId: "storegold-649cb",
  storageBucket: "storegold-649cb.firebasestorage.app",
  messagingSenderId: "149670720956",
  appId: "1:149670720956:web:4e13b02221265e0e65e7b9",
  measurementId: "G-C6CKG3EWVB"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();




    let editingBetId = null;
    let competition = null;
    let order = 1;
    const bets = [];

    function addBet() {
      const compNum = document.getElementById("competitionNumber").value.trim();
      if (competition === null && compNum !== "") competition = compNum;

      const code = document.getElementById("playerCode").value.trim();
      const amount = parseFloat(document.getElementById("betAmount").value);
      const team = document.getElementById("chosenTeam").value.trim();

      if (!code || !amount || !team || !competition) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.");

      const betId = parseInt(competition) * 10000 + order;
      const bet = { id: betId, code, amount, team };
      db.ref(`bets/${betId}`).set(bet);

      bets.push(bet);
      appendToTable(bet);
      order++;
      document.getElementById("playerCode").value = "";
      document.getElementById("betAmount").value = "";
      document.getElementById("chosenTeam").value = "";
    }

    function appendToTable(bet) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${bet.id}</td>
        <td>${bet.code}</td>
        <td>${bet.amount}</td>
        <td>${bet.team}</td>
        <td><button onclick="editBet(${bet.id})">âœï¸</button></td>
        <td><button onclick="deleteBet(${bet.id})">ğŸ—‘ï¸</button></td>
      `;
      document.getElementById("betsBody").appendChild(row);
    }

    function deleteBet(id) {
  if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‡Ø§Ù†ØŸ")) return;

  db.ref(`bets/${id}`).remove(() => {
    location.reload(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
  });
}


    function showEndSection() {
      document.getElementById("endSection").classList.remove("hidden");
    }

    function calculateResults() {
      const winning = document.getElementById("winningTeam").value.trim();
      if (!winning) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ§Ø¦Ø².");

      const betsRef = db.ref("bets");
      betsRef.once("value", snapshot => {
        const allBets = snapshot.val();
        let total = 0, totalWin = 0;
        const resultLines = [];

        for (let id in allBets) {
          total += allBets[id].amount;
          if (allBets[id].team === winning) totalWin += allBets[id].amount;
        }

        for (let id in allBets) {
          const b = allBets[id];
          if (b.team === winning) {
            const gain = ((b.amount / totalWin) * (total * 0.90)).toFixed(2);
            resultLines.push(`${b.code} : +${gain}`);
          } else {
            resultLines.push(`${b.code} : -${b.amount}`);
          }
        }

        const tax = (total * 0.10).toFixed(2);
        resultLines.push("Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€");
        resultLines.push(`ğŸ’¸ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: ${tax}`);

        document.getElementById("resultsText").textContent = resultLines.join("\n");
        document.getElementById("resultsBox").classList.remove("hidden");
      });
    }

    function copyResults() {
      const text = document.getElementById("resultsText").textContent;
      navigator.clipboard.writeText(text);
      alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬!");
    }


    // Ø²Ø± Ø§Ù„Ø­Ø°Ù Ùˆ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 
    function editBet(id) {
  db.ref(`bets/${id}`).once("value", snapshot => {
    const data = snapshot.val();
    if (data) {
      editingBetId = id;
      document.getElementById("editCode").value = data.code;
      document.getElementById("editAmount").value = data.amount;
      document.getElementById("editTeam").value = data.team;
      document.getElementById("editModal").classList.remove("hidden");
      document.getElementById("overlay").style.display = "block";
    }
  });
}


function saveEdit() {
  const newCode = document.getElementById("editCode").value.trim();
  const newAmount = parseFloat(document.getElementById("editAmount").value);
  const newTeam = document.getElementById("editTeam").value.trim();

  if (!newCode || !newAmount || !newTeam) {
    alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!");
    return;
  }

  const updated = { id: editingBetId, code: newCode, amount: newAmount, team: newTeam };
  db.ref(`bets/${editingBetId}`).set(updated, (err) => {
    if (!err) {
      alert("ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
      location.reload(); // Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
    }
  });
}

function closeEditModal() {
  editingBetId = null;
  document.getElementById("editModal").classList.add("hidden");
  document.getElementById("overlay").style.display = "none";
}

window.onload = function () {
  const compInput = document.getElementById("competitionNumber");

  db.ref("bets").once("value", snapshot => {
    const data = snapshot.val();
    if (!data) return;

    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØµØ§Ø¹Ø¯ÙŠ
    const sortedBets = Object.values(data).sort((a, b) => a.id - b.id);

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙˆØ§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
    if (sortedBets.length > 0) {
      const firstId = sortedBets[0].id;
      competition = Math.floor(firstId / 10000); // Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø¹Ø´Ø±Ø§Øª Ø§Ù„Ø¢Ù„Ø§Ù
      compInput.value = competition;

      const lastId = sortedBets[sortedBets.length - 1].id;
      order = lastId % 10000 + 1; // Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    sortedBets.forEach(bet => {
      bets.push(bet);
      appendToTable(bet);
    });
  });
}



  </script>
</body>
</html>
